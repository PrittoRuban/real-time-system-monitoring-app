<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Training Dashboard</title>
    <style>
      /* Global resets */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Modern font */
      body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(to bottom, #1a1a1a, #4caf50);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
      }

      .container {
        width: 90vw;
        max-width: 800px;
        height: 90vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
        background-color: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.5);
      }

      h1 {
        font-size: 2em;
        margin-bottom: 10px;
      }

      h3 {
        margin: 10px 0;
        font-size: 1.3em;
        color: #4caf50;
      }

      .progress-bar {
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-bar-fill {
        height: 20px;
        width: 0%;
        background-color: #4caf50;
        box-shadow: 0px 2px 8px rgba(0, 255, 0, 0.5);
        transition: width 0.4s ease;
        border-radius: inherit;
      }

      canvas {
        width: 100%;
        max-height: 200px;
      }

      #logs {
        max-height: 20vh;
        overflow-y: auto;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        text-align: left;
        font-size: 0.9em;
        border-radius: 10px;
        color: #ddd;
      }

      #logs::-webkit-scrollbar {
        width: 8px;
      }

      #logs::-webkit-scrollbar-thumb {
        background-color: #4caf50;
        border-radius: 10px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>Real-Time Training Dashboard</h1>

      <!-- Epoch Progress -->
      <h3>Epoch Progress</h3>
      <div class="progress-bar">
        <div id="epoch-progress" class="progress-bar-fill"></div>
      </div>

      <h3>Batch Progress</h3>
      <div class="progress-bar">
        <div id="batch-progress" class="progress-bar-fill"></div>
      </div>

      <!-- Graph for Loss and Accuracy -->
      <h3>Training Loss and Accuracy</h3>
      <canvas id="chart"></canvas>

      <!-- Log Section -->
      <h3>Training Logs</h3>
      <div id="logs"></div>
    </div>

    <script>
      var socket = io.connect(
        "http://" + document.domain + ":" + location.port
      );

      // Progress bar update function
      function updateProgressBar(elementId, percentage) {
        document.getElementById(elementId).style.width = percentage + "%";
      }

      // Add logs to log section
      function addLog(message) {
        const logs = document.getElementById("logs");
        logs.innerHTML += message + "<br>";
        logs.scrollTop = logs.scrollHeight; // Auto scroll to the latest log
      }

      // Chart.js setup for loss and accuracy graph
      var ctx = document.getElementById("chart").getContext("2d");
      var chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Loss",
              borderColor: "red",
              fill: false,
              data: [],
            },
            {
              label: "Accuracy",
              borderColor: "blue",
              fill: false,
              data: [],
            },
          ],
        },
      });

      // Handle real-time updates from backend
      socket.on("training_data", function (data) {
        // Update progress bars
        updateProgressBar(
          "epoch-progress",
          (data.iteration / data.total_batches) * 100
        );
        updateProgressBar("batch-progress", (data.batch_accuracy / 100) * 100);

        // Update chart with new loss and accuracy
        chart.data.labels.push(`Epoch ${data.epoch}, Iter ${data.iteration}`);
        chart.data.datasets[0].data.push(data.loss);
        chart.data.datasets[1].data.push(data.accuracy);
        chart.update();

        // Add logs
        addLog(
          `Epoch: ${data.epoch}, Iter: ${data.iteration} | Loss: ${data.loss}, Accuracy: ${data.accuracy}%`
        );
      });

      // Start training on page load
      socket.emit("start_training");
    </script>
  </body>
</html>
